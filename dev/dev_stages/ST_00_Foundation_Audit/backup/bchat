#!/bin/bash
# Enhanced bchat - Chat backup, status, and Gemini CLI wrapper

# Resolve the script directory
SCRIPT_DIR="$(cd -P "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Handle status command
if [ "$1" = "--status" ] || [ "$1" = "status" ]; then
    exec "$SCRIPT_DIR/bin/bchat-status"
fi

# If no arguments provided, trigger chat backup/consolidation
if [ $# -eq 0 ]; then
    echo "üîÑ Triggering chat backup and consolidation..."
    
    # Run chat monitor consolidation
    if [ -x "$SCRIPT_DIR/bin/rchat" ]; then
        "$SCRIPT_DIR/bin/rchat" --consolidate
        echo "‚úÖ Chat backup completed"
    else
        echo "‚ùå bchat monitor not found. Please run ./install.sh first."
        exit 1
    fi
else
    # Pass arguments to gemini wrapper for normal Gemini CLI usage
    exec "$SCRIPT_DIR/config/wrappers/gemini_wrapper.sh" "$@"
fi